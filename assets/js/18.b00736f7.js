(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{521:function(e,s,a){"use strict";a.r(s);var r=a(6),t=Object(r.a)({},function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"_1-启动mysql服务器实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动mysql服务器实例","aria-hidden":"true"}},[e._v("#")]),e._v(" 1. 启动"),a("code",[e._v("mysql")]),e._v("服务器实例")]),e._v(" "),a("p",[e._v("启动一个MySQL实例很简单：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("...此处"),a("code",[e._v("some-mysql")]),e._v("是您要分配给容器的名称，"),a("code",[e._v("my-secret-pw")]),e._v("是要为MySQL根用户设置的密码，并且"),a("code",[e._v("tag")]),e._v("是指定所需MySQL版本的标记。有关相关标签，请参见上面的列表。")]),e._v(" "),a("h3",{attrs:{id:"_1-1从mysql命令行客户端连接到mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1从mysql命令行客户端连接到mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" 1.1从MySQL命令行客户端连接到MySQL")]),e._v(" "),a("p",[e._v("以下命令启动另一个"),a("code",[e._v("mysql")]),e._v("容器实例，并"),a("code",[e._v("mysql")]),e._v("针对原始"),a("code",[e._v("mysql")]),e._v("容器运行命令行客户端，从而允许您针对数据库实例执行SQL语句：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run -it --network some-network --rm mysql mysql -hsome-mysql -uexample-user -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("... "),a("code",[e._v("some-mysql")]),e._v("原始"),a("code",[e._v("mysql")]),e._v("容器的名称在哪里（连接到"),a("code",[e._v("some-network")]),e._v("Docker网络）。")]),e._v(" "),a("p",[e._v("该映像也可用作非Docker或远程实例的客户端：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run -it --rm mysql mysql -hsome.mysql.host -usome-mysql-user -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("有关MySQL命令行客户端的更多信息，请参见"),a("a",{attrs:{href:"http://dev.mysql.com/doc/en/mysql.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("MySQL文档。"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"_1-2-通过docker-stack-deploy或docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-通过docker-stack-deploy或docker-compose","aria-hidden":"true"}},[e._v("#")]),e._v(" 1.2 通过"),a("code",[e._v("docker stack deploy")]),e._v("或"),a("code",[e._v("docker-compose")])]),e._v(" "),a("p",[e._v("实施例"),a("code",[e._v("stack.yml")]),e._v("为"),a("code",[e._v("mysql")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("## Use root/example as user/password credentials\nversion: '3.1'\n\nservices:\n\n  db:\n    image: mysql\n    command: --default-authentication-plugin=mysql_native_password\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: example\n\n  adminer:\n    image: adminer\n    restart: always\n    ports:\n      - 8080:8080\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])]),a("p",[a("a",{attrs:{href:"http://play-with-docker.com/?stack=https://raw.githubusercontent.com/docker-library/docs/b664a62bb7be3e0cbc2304e306ea42f33244fad1/mysql/stack.yml",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://github.com/play-with-docker/stacks/raw/cff22438cb4195ace27f9b15784bbb497047afa7/assets/images/button.png",alt:"尝试PWD"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("运行"),a("code",[e._v("docker stack deploy -c stack.yml mysql")]),e._v("（或"),a("code",[e._v("docker-compose -f stack.yml up")]),e._v("），等它完全初始化，并且访问"),a("code",[e._v("http://swarm-ip:8080")]),e._v("，"),a("code",[e._v("http://localhost:8080")]),e._v("或"),a("code",[e._v("http://host-ip:8080")]),e._v("（如适用）。")]),e._v(" "),a("h3",{attrs:{id:"_1-3-容器外壳访问和查看mysql日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-容器外壳访问和查看mysql日志","aria-hidden":"true"}},[e._v("#")]),e._v(" 1.3 容器外壳访问和查看MySQL日志")]),e._v(" "),a("p",[e._v("该"),a("code",[e._v("docker exec")]),e._v("命令允许您在Docker容器中运行命令。以下命令行将在"),a("code",[e._v("mysql")]),e._v("容器内为您提供一个bash shell ：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker exec -it some-mysql bash\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("该日志可通过Docker的容器日志获取：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker logs some-mysql\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"_2-常用的mysql环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-常用的mysql环境变量","aria-hidden":"true"}},[e._v("#")]),e._v(" 2. 常用的mysql环境变量")]),e._v(" "),a("h3",{attrs:{id:"_2-1-使用自定义mysql配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-使用自定义mysql配置文件","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.1 使用自定义MySQL配置文件")]),e._v(" "),a("p",[e._v("MySQL的默认配置可以在中找到"),a("code",[e._v("/etc/mysql/my.cnf")]),e._v("，其中可以包含"),a("code",[e._v("!includedir")]),e._v("其他目录，例如"),a("code",[e._v("/etc/mysql/conf.d")]),e._v("或"),a("code",[e._v("/etc/mysql/mysql.conf.d")]),e._v("。请检查"),a("code",[e._v("mysql")]),e._v("映像本身中的相关文件和目录以获取更多详细信息。")]),e._v(" "),a("p",[e._v("如果"),a("code",[e._v("/my/custom/config-file.cnf")]),e._v("是自定义配置文件的路径和名称，则可以"),a("code",[e._v("mysql")]),e._v("像这样启动容器（请注意，此命令仅使用自定义配置文件的目录路径）：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("这将启动一个新的容器"),a("code",[e._v("some-mysql")]),e._v("，其中MySQL实例从采用混合启动设置"),a("code",[e._v("/etc/mysql/my.cnf")]),e._v("和"),a("code",[e._v("/etc/mysql/conf.d/config-file.cnf")]),e._v("，与后者采取优先次序设置。")]),e._v(" "),a("h4",{attrs:{id:"没有cnf文件的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#没有cnf文件的配置","aria-hidden":"true"}},[e._v("#")]),e._v(" 没有"),a("code",[e._v("cnf")]),e._v("文件的配置")]),e._v(" "),a("p",[e._v("可以将许多配置选项作为标志传递给"),a("code",[e._v("mysqld")]),e._v("。这将使您可以灵活地自定义容器，而无需"),a("code",[e._v("cnf")]),e._v("文件。例如，如果要更改所有表的默认编码和排序规则以使用UTF-8（"),a("code",[e._v("utf8mb4")]),e._v("），请运行以下命令：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("如果您想查看可用选项的完整列表，请运行：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run -it --rm mysql:tag --verbose --help\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-2-环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-环境变量","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2 环境变量")]),e._v(" "),a("p",[e._v("启动"),a("code",[e._v("mysql")]),e._v("映像时，可以通过在"),a("code",[e._v("docker run")]),e._v("命令行上传递一个或多个环境变量来调整MySQL实例的配置。请注意，如果使用已包含数据库的数据目录启动容器，则以下任何变量都将无效：容器启动时，任何现有数据库都将保持不变。")]),e._v(" "),a("p",[e._v("另请参阅"),a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/environment-variables.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://dev.mysql.com/doc/refman/5.7/en/environment-variables.html，"),a("OutboundLink")],1),e._v("以获取MySQL本身尊重的环境变量的文档（尤其是类似的变量"),a("code",[e._v("MYSQL_HOST")]),e._v("，该变量在与该映像配合使用时会引起问题） ）。")]),e._v(" "),a("h4",{attrs:{id:"mysql-root-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-root-password","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_ROOT_PASSWORD")])]),e._v(" "),a("p",[e._v("此变量是必需变量，它指定将为MySQL "),a("code",[e._v("root")]),e._v("超级用户帐户设置的密码。在上面的示例中，将其设置为"),a("code",[e._v("my-secret-pw")]),e._v("。")]),e._v(" "),a("h4",{attrs:{id:"mysql-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-database","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_DATABASE")])]),e._v(" "),a("p",[e._v("此变量是可选的，允许您指定在映像启动时要创建的数据库的名称。如果提供了用户名/密码（请参阅下文），则将授予该用户对该数据库的超级用户访问权限（"),a("a",{attrs:{href:"http://dev.mysql.com/doc/en/adding-users.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("与相对应"),a("code",[e._v("GRANT ALL")]),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("h4",{attrs:{id:"mysql-user-mysql-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-user-mysql-password","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_USER")]),e._v(", "),a("code",[e._v("MYSQL_PASSWORD")])]),e._v(" "),a("p",[e._v("这些变量是可选的，与创建新用户和设置该用户的密码一起使用。该"),a("code",[e._v("MYSQL_DATABASE")]),e._v("变量将为该用户授予超级用户权限（请参见上文）。这两个变量都是创建用户所必需的。")]),e._v(" "),a("p",[e._v("请注意，不需要使用此机制来创建根超级用户，该用户默认情况下是使用"),a("code",[e._v("MYSQL_ROOT_PASSWORD")]),e._v("变量指定的密码创建的。")]),e._v(" "),a("h4",{attrs:{id:"mysql-allow-empty-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-allow-empty-password","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_ALLOW_EMPTY_PASSWORD")])]),e._v(" "),a("p",[e._v("这是一个可选变量。设置为"),a("code",[e._v("yes")]),e._v("允许以root用户的空白密码启动容器。"),a("em",[e._v("注意")]),e._v("："),a("code",[e._v("yes")]),e._v("除非您真的知道自己在做什么，否则不建议将此变量设置为，因为这将使您的MySQL实例完全不受保护，从而使任何人都可以获得完全的超级用户访问权限。")]),e._v(" "),a("h4",{attrs:{id:"mysql-random-root-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-random-root-password","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_RANDOM_ROOT_PASSWORD")])]),e._v(" "),a("p",[e._v("这是一个可选变量。设置"),a("code",[e._v("yes")]),e._v("为为root用户生成一个随机的初始密码（使用"),a("code",[e._v("pwgen")]),e._v("）。生成的root密码将被打印到stdout（"),a("code",[e._v("GENERATED ROOT PASSWORD: .....")]),e._v("）。")]),e._v(" "),a("h4",{attrs:{id:"mysql-onetime-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-onetime-password","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("code",[e._v("MYSQL_ONETIME_PASSWORD")])]),e._v(" "),a("p",[e._v("初始化完成后，将root用户（"),a("em",[e._v("不是")]),a("code",[e._v("MYSQL_USER")]),e._v("！中指定的用户）设置为过期用户，从而在首次登录时强制更改密码。"),a("em",[e._v("注意")]),e._v("：仅MySQL 5.6+支持此功能。在MySQL 5.5上使用此选项将在初始化期间引发适当的错误。")]),e._v(" "),a("h3",{attrs:{id:"_2-3-docker的秘密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-docker的秘密","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3 Docker的秘密")]),e._v(" "),a("p",[e._v("作为通过环境变量传递敏感信息的替代方法，"),a("code",[e._v("_FILE")]),e._v("可以将其附加到先前列出的环境变量中，从而使初始化脚本从容器中存在的文件中加载这些变量的值。特别是，这可用于从"),a("code",[e._v("/run/secrets/")]),e._v("文件中存储的Docker机密加载密码。例如：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql-root -d mysql:tag\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("目前，这仅支持"),a("code",[e._v("MYSQL_ROOT_PASSWORD")]),e._v("，"),a("code",[e._v("MYSQL_ROOT_HOST")]),e._v("，"),a("code",[e._v("MYSQL_DATABASE")]),e._v("，"),a("code",[e._v("MYSQL_USER")]),e._v("，和"),a("code",[e._v("MYSQL_PASSWORD")]),e._v("。")]),e._v(" "),a("h2",{attrs:{id:"_3-初始化一个新实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-初始化一个新实例","aria-hidden":"true"}},[e._v("#")]),e._v(" 3. 初始化一个新实例")]),e._v(" "),a("p",[e._v("首次启动容器时，将创建一个具有指定名称的新数据库，并使用提供的配置变量对其进行初始化。此外，它会执行文件（可扩展）"),a("code",[e._v(".sh")]),e._v("，"),a("code",[e._v(".sql")]),e._v("并且"),a("code",[e._v(".sql.gz")]),e._v("是在发现"),a("code",[e._v("/docker-entrypoint-initdb.d")]),e._v("。文件将按字母顺序执行。您可以"),a("code",[e._v("mysql")]),e._v("通过"),a("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-file-as-a-data-volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("将SQL转储装载到该目录中"),a("OutboundLink")],1),e._v("并为"),a("a",{attrs:{href:"https://docs.docker.com/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[e._v("自定义图像"),a("OutboundLink")],1),e._v("提供贡献的数据来轻松填充服务。默认情况下，SQL文件将导入到"),a("code",[e._v("MYSQL_DATABASE")]),e._v("变量指定的数据库中。")]),e._v(" "),a("h2",{attrs:{id:"_4-注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-注意事项","aria-hidden":"true"}},[e._v("#")]),e._v(" 4. 注意事项")]),e._v(" "),a("h3",{attrs:{id:"_4-1-数据存储位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-数据存储位置","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.1 数据存储位置")]),e._v(" "),a("p",[e._v("重要说明：有几种方法可以存储在Docker容器中运行的应用程序使用的数据。我们鼓励"),a("code",[e._v("mysql")]),e._v("图像用户熟悉可用的选项，包括：")]),e._v(" "),a("ul",[a("li",[e._v("让Docker "),a("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#adding-a-data-volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("通过使用自己的内部卷管理将数据库文件写入主机系统上的磁盘，从而"),a("OutboundLink")],1),e._v("管理数据库数据的存储。这是默认设置，对用户来说是简单且相当透明的。不利之处在于，对于直接在主机系统（即外部容器）上运行的工具和应用程序而言，文件可能难以定位。")]),e._v(" "),a("li",[e._v("在主机系统上（容器外部）创建一个数据目录，并将其"),a("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-directory-as-a-data-volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装到从容器内部可见的目录中"),a("OutboundLink")],1),e._v("。这会将数据库文件放置在主机系统上的已知位置，并使主机系统上的工具和应用程序易于访问文件。缺点是用户需要确保目录存在，并且例如必须正确设置主机系统上的目录权限和其他安全机制。")])]),e._v(" "),a("p",[e._v("Docker文档是了解不同存储选项和变体的一个很好的起点，并且有多个博客和论坛文章讨论了这一领域并提供了建议。我们将在此处仅显示上述后一种选择的基本过程：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("在主机系统上的适当卷上创建数据目录，例如"),a("code",[e._v("/my/own/datadir")]),e._v("。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("mysql")]),e._v("像这样启动您的容器：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])]),e._v(" "),a("p",[e._v("该"),a("code",[e._v("-v /my/own/datadir:/var/lib/mysql")]),e._v("命令的一部分"),a("code",[e._v("/my/own/datadir")]),e._v("从底层主机系统"),a("code",[e._v("/var/lib/mysql")]),e._v("在容器内部安装目录，默认情况下，MySQL将在该目录中写入其数据文件。")]),e._v(" "),a("h3",{attrs:{id:"_4-2-在mysql初始化完成之前没有连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-在mysql初始化完成之前没有连接","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.2 在MySQL初始化完成之前没有连接")]),e._v(" "),a("p",[e._v("如果在容器启动时没有初始化数据库，则将创建一个默认数据库。尽管这是预期的行为，但这意味着在初始化完成之前它将不接受传入的连接。使用自动化工具（例如）"),a("code",[e._v("docker-compose")]),e._v("同时启动多个容器时，这可能会引起问题。")]),e._v(" "),a("p",[e._v("如果您尝试连接到MySQL的应用程序无法处理MySQL停机时间或等待MySQL正常启动，则可能有必要在服务启动之前放置connect-retry循环。有关官方图像中此类实现的示例，请参阅"),a("a",{attrs:{href:"https://github.com/docker-library/wordpress/blob/1b48b4bccd7adb0f7ea1431c7b470a40e186f3da/docker-entrypoint.sh#L195-L235",target:"_blank",rel:"noopener noreferrer"}},[e._v("WordPress"),a("OutboundLink")],1),e._v("或"),a("a",{attrs:{href:"https://github.com/docker-library/docs/blob/9660a0cccb87d8db842f33bc0578d769caaf3ba9/bonita/stack.yml#L28-L44",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bonita"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("h3",{attrs:{id:"_4-3-针对现有数据库的用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-针对现有数据库的用法","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.3 针对现有数据库的用法")]),e._v(" "),a("p",[e._v("如果"),a("code",[e._v("mysql")]),e._v("使用已经包含数据库的数据目录（特别是"),a("code",[e._v("mysql")]),e._v("子目录）启动容器实例，"),a("code",[e._v("$MYSQL_ROOT_PASSWORD")]),e._v("则应在运行命令行中省略该变量；在任何情况下都将忽略它，并且不会以任何方式更改现有数据库。")]),e._v(" "),a("h3",{attrs:{id:"_4-4-以任意用户身份运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-以任意用户身份运行","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.4 以任意用户身份运行")]),e._v(" "),a("p",[e._v("如果您知道目录的权限已经适当设置（例如，如上所述，针对现有数据库运行），或者需要"),a("code",[e._v("mysqld")]),e._v("使用特定的UID / GID 运行，则可以将此映像"),a("code",[e._v("--user")]),e._v("设置为任意值（"),a("code",[e._v("root")]),e._v("/ "),a("code",[e._v("0")]),e._v("除外）以实现所需的访问/配置：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('$ mkdir data\n$ ls -lnd data\ndrwxr-xr-x 2 1000 1000 4096 Aug 27 15:54 data\n$ docker run -v "$PWD/data":/var/lib/mysql --user 1000:1000 --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h3",{attrs:{id:"_4-5-创建数据库转储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-创建数据库转储","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.5 创建数据库转储")]),e._v(" "),a("p",[e._v("大多数普通工具都可以使用，尽管在某些情况下它们的使用可能会有些麻烦，以确保它们可以访问"),a("code",[e._v("mysqld")]),e._v("服务器。确保这一点的一种简单方法是"),a("code",[e._v("docker exec")]),e._v("在同一容器中使用和运行该工具，类似于以下内容：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker exec some-mysql sh -c 'exec mysqldump --all-databases -uroot -p\"$MYSQL_ROOT_PASSWORD\"' > /some/path/on/your/host/all-databases.sql\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-6-从转储文件还原数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-从转储文件还原数据","aria-hidden":"true"}},[e._v("#")]),e._v(" 4.6 从转储文件还原数据")]),e._v(" "),a("p",[e._v("用于还原数据。您可以使用"),a("code",[e._v("docker exec")]),e._v("带"),a("code",[e._v("-i")]),e._v("标志的命令，类似于以下内容：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ docker exec -i some-mysql sh -c 'exec mysql -uroot -p\"$MYSQL_ROOT_PASSWORD\"' < /some/path/on/your/host/a\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"_5-最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-最佳实践","aria-hidden":"true"}},[e._v("#")]),e._v(" 5. 最佳实践")]),e._v(" "),a("h3",{attrs:{id:"_5-1-创建mysql初始化文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-创建mysql初始化文件","aria-hidden":"true"}},[e._v("#")]),e._v(" 5.1 创建mysql初始化文件")]),e._v(" "),a("p",[a("code",[e._v("vim init.sql")])]),e._v(" "),a("h3",{attrs:{id:"_8-0-版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-0-版本","aria-hidden":"true"}},[e._v("#")]),e._v(" 8.0+版本")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("use mysql;\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'root123';\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"_5-7-版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-版本","aria-hidden":"true"}},[e._v("#")]),e._v(" 5.7+版本")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("use mysql;\ngrant all privileges on *.* to 'root'@'%' identified by '123456' with grant option;\nflush privileges;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"_5-2-创建个人配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-创建个人配置文件","aria-hidden":"true"}},[e._v("#")]),e._v(" 5.2 创建个人配置文件")]),e._v(" "),a("p",[a("code",[e._v("vim my.cnf")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[mysqld]\nuser=mysql\ndefault-storage-engine=INNODB\ncharacter-set-server=utf8\n[client]\ndefault-character-set=utf8\n[mysql]\ndefault-character-set=utf8\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("h3",{attrs:{id:"_5-3-创建mysql实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-创建mysql实例","aria-hidden":"true"}},[e._v("#")]),e._v(" 5.3 创建mysql实例")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker run -di --name mysql -p 3306:3306 -v /root/mysql/db:/var/lib/mysql -v /root/mysql/config/my.cnf:/etc/my.cnf -v /root/mysql/init:/docker-entrypoint-initdb.d/ -e MYSQL_ROOT_PASSWORD=root123 mysql:tag\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])},[],!1,null,null,null);s.default=t.exports}}]);